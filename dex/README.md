# serum-dex

All build steps should be run from the top level repo directory.

## Deploying the DEX

### Run unit tests

```
./do.sh test dex
```

### Compile the dex binary

```
./do.sh build dex
```

### Deploy the dex to the configured solana cluster

```
DEX_PROGRAM_ID="$(solana deploy dex/target/bpfel-unknown-unknown/release/serum_dex.so --use-deprecated-loader | jq .programId -r)"
```

## Run the fuzz tests

```
cd dex
cargo install cargo-fuzz
cargo fuzz run multiple_orders
```

## Using the client utility

```
cd crank

# read the autogenerated help text
cargo run -- help

# supported options are localnet, mainnet, testnet, devnet
CLUSTER=localnet

# verify that you have SOL balances for gas
KEYPAIR=~/.config/solana/id.json
solana balance -k $KEYPAIR

# run the demo script (this is mostly a smoke test)
cargo run -- $CLUSTER whole-shebang $KEYPAIR $DEX_PROGRAM_ID

# list a market with the default tick size and minimum quantity.
# if both assets have 6 decimals, this will be a quantity of 1 and a tick size of 0.01
COIN_MINT="..."
PRICE_CURRENCY_MINT="..."
cargo run -- $CLUSTER list-market $KEYPAIR $DEX_PROGRAM_ID --coin-mint $COIN_MINT --pc-mint $PRICE_CURRENCY_MINT
```

## Building the DEX
```
./do.sh build dex
```

## Run the whole-shebang

First, run a solana cluster in a new shell and then run the demo script (this is mostly
just a smoke test).

```
DEX_PROGRAM_ID="$(solana deploy dex/target/bpfel-unknown-unknown/release/serum_dex.so --use-deprecated-loader | jq .programId -r)"
CLUSTER=localnet
KEYPAIR=~/.config/solana/id.json

cargo run -- $CLUSTER whole-shebang $KEYPAIR $DEX_PROGRAM_ID
```
